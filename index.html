<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/png" href="/icons/icon-192x192.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Kuri - Community Saving Circles</title>

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#C84E31" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="Kuri" />
    <!-- iOS-Optimized Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon-180x180.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-touch-icon-152x152.png" />
    <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-touch-icon-76x76.png" />
    <!-- Fallback for older devices -->
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon-180x180.png" />
    <meta
      name="description"
      content="Rotation savings circles - Join circles, make contributions, and build financial backup"
    />

    <!-- Material Icons -->
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />

    <!-- Manifest -->
    <link rel="manifest" href="/manifest.json" />

    <!-- OneSignal SDK v16 - Official Dashboard Code -->
    <script
      src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js"
      defer
    ></script>
    <script>
      window.OneSignalDeferred = window.OneSignalDeferred || [];
      OneSignalDeferred.push(async function (OneSignal) {
        try {
          await OneSignal.init({
            appId: "5ad950da-8f42-4194-bbe0-b2b7d64c79c1",
            safari_web_id:
              "web.onesignal.auto.1f7edc6b-077e-4a04-b244-6d0a0c671761",
            notifyButton: {
              enable: true,
              size: "medium", // 'small', 'medium', 'large'
              position: "bottom-right", // 'top-left', 'top-right', 'bottom-left', 'bottom-right'
              offset: {
                bottom: "20px",
                right: "20px",
              },
              colors: {
                "circle.background": "#C84E31", // Match your theme color
                "circle.foreground": "white",
                "badge.background": "#ff6b6b",
                "badge.foreground": "white",
                "badge.bordercolor": "white",
                "pulse.color": "#C84E31",
              },
              text: {
                "tip.state.unsubscribed": "Subscribe to notifications",
                "tip.state.subscribed": "You're subscribed to notifications",
                "tip.state.blocked": "Unblock notifications",
                "message.prenotify": "Click to subscribe to notifications",
                "message.action.subscribed":
                  "Thanks! You'll receive notifications for new updates.",
                "message.action.resubscribed":
                  "You're subscribed to notifications",
                "message.action.unsubscribed":
                  "You won't receive notifications again",
                "dialog.main.title": "Manage Site Notifications",
                "dialog.main.button.subscribe": "SUBSCRIBE",
                "dialog.main.button.unsubscribe": "UNSUBSCRIBE",
              },
              theme: "default", // 'default', 'inverse'
              displayPredicate: function () {
                // Hide button if user is already subscribed
                try {
                  if (
                    window.OneSignal &&
                    window.OneSignal.User &&
                    window.OneSignal.User.PushSubscription
                  ) {
                    const isSubscribed =
                      window.OneSignal.User.PushSubscription.optedIn;
                    const hasPermission =
                      window.OneSignal.Notifications &&
                      window.OneSignal.Notifications.permission;

                    // Only show if user is NOT subscribed or doesn't have permission
                    return !isSubscribed || !hasPermission;
                  }
                  return true; // Show by default if OneSignal not ready
                } catch (error) {
                  console.log(
                    "OneSignal displayPredicate check failed:",
                    error
                  );
                  return true; // Show by default on error
                }
              },
            },
          });
          console.log("✅ OneSignal: Initialization successful");

          // Make OneSignal globally accessible for debugging
          window._OneSignalDebug = OneSignal;
          window.OneSignal = OneSignal;
        } catch (error) {
          console.error("❌ OneSignal: Initialization failed:", error);
        }
      });
    </script>

    <!-- Farcaster Mini App Metadata -->
    <meta
      property="fc:frame"
      content='{
        "version": "1",
        "imageUrl": "https://kuri-web-rust.vercel.app/images/financialempowerment.jpg",
        "button": {
          "title": "Check this out",
          "action": {
            "type": "launch_frame",
            "name": "Example Frame",
            "url": "https://kuri-web-rust.vercel.app",
            "splashImageUrl": "https://kuri-web-rust.vercel.app/images/communityvibe.jpg",
            "splashBackgroundColor": "#eeccff"
          }
        }
      }'
    />
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
